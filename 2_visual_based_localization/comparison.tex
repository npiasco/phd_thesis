\section{Discussion}
\label{sec:comparison}
	This section aims to highlight common usage and promising research avenues in \ac{vbl}. As \ac{vbl} panorama is wide and varied, we first propose a review of recent datasets and evaluation metrics used for comparing different approaches.
	
	\subsection{Datasets}
		Commonly used datasets in \ac{vbl} are presented in table~\ref{tab:dataset}. Because of the important difference between 6-\ac{dof} pose estimation and \ac{cbir} for localization methods, there exists two kinds of datasets used in \ac{vbl}: list of images (with basic position information or landmark/place tags) and spatially consistent datasets (that can be composed of point cloud or fine geo-referenced images). Notice the growing number of publicly available datasets starring complete 3D scans of large cities~\citep{Menze2015,Maddern2016,Wang2016}. As mentioned earlier, long-term localization in changing environment is an hot topic in robotic research. We observe therefore appearance of several datasets featuring multiple acquisitions of the same place over long period of time~\citep{Maddern2016,Carlevaris-Bianco2016,Krajnik2010,Krajnik2014}.
		
		For landmarks recognition in city (used method come mainly from \ac{cbir} for localization approaches), the revisited version of Oxford and Paris datasets~\citep{Radenovic2018} is the most used dataset. Concerning precise 6-\ac{dof} pose estimation under changing condition for long-term localization, researchers prefer the benchmark from \citet{Sattler2018} that compile multiples long-term focused datasets.
		
		\paragraph{Coverage and consistency.}
		\label{para:coverage_consistency}
		All the application relying on \ac{vbl} do not cover the same area. For instance, a system design for car pose estimation should be able to localize a vehicle in a larger area than a pedestrian \ac{vbl} system should do. Thus, there exists dataset with a coverage spreading from small indoor scenes to world-wide area.
	
		Visual content within a dataset can be uniform, reference and queries are from the same sensor and captured at the same time, or inconsistent, queries have been taken under different condition or with different sensor than the references data. In order to reflect real-life conditions, outdoor datasets are often inconsistent, with visual dissimilarity between queries and references induced by acquisition sensors, dynamic changes in the scene (cars \& pedestrians),  the weather etc. Indoor datasets use more uniform data~\citep{Shotton2013}, thus targeting application like camera re-localization for robot navigation or augmented reality.

		\paragraph{Evaluation Metrics.}
		\label{subsec:evaluation_metric}
			Authors use various types of performances criteria in order to compare \ac{cbir} for localization methods. The recall @$k$, or recall @$k$\%, is the most used metric. It represents the percentage of queries that present a good match within the $k$ or $k$\% top ranked images. A query is considered correctly localized if it lies inside a tolerance radius from its ground truth position (usually 10 to 25m, depending on the dataset).  Usually $k$ is set to 10 or 1\%. If we consider only the top 1 retrieved candidate for evaluation, distance from the ground truth is used as the main precision criteria. For places or landmarks recognition tasks~\citep{Radenovic2018}, \ac{map} is used to evaluate performances.
			
			Concerning 6-\ac{dof} pose estimation methods, authors often simply compute the mean or median of absolute position and orientation error relative to the ground truth. Another criterion can be extracted from the inlier count obtained against a robust geometric verification (for image based localization). A query is considered as successfully matched if enough inliers are found after \ac{ransac}. However, such a metric does not ensure that the data is well localized according to the model~\citep{Sattler2015}. Percentage of well localized images, \ie under a given error threshold (5cm \& 5$^{\circ}$ for indoor scene), is also a current evaluation metric.  Recently, \citet{Sattler2018} introduce a more detailed metric by considering multiple level of precision (from fine to coarse localization) with different thresholds.
			
	 \input{2_visual_based_localization/tabs/datasets}

	\subsection{Runtime consideration}
		\label{subsec:runtime}
		Real-time performances and embedded architectures are constraints mainly present in the robotic community. In \ac{vbl}, such criteria are not always taken into account. This can be explained by the fact that recovering the localization of an input query is a one-shoot action; i.e. it has to be performed only once compared to tracking systems~\citep{Marchand2016} or SLAM algorithms~\citep{Garcia-Fidalgo2015}. Furthermore, more and more embedded systems rely on deported architecture or cloud computer, resolving the problem of low computational power of portable devices~\citep{Middelberg2014}. Yet, some authors manage to reduce the computational cost of their system~\citep{Shotton2013,Glocker2015,Lynen2015}: for instance \citet{Feng2016a} introduce a light version of F2P method and works from~\citep{Weyand2016,Kendall2015,Contreras2017} embed their localization system in a compact CNN architecture loadable on a smart-phone.
			
	\subsection{Trends in VBL}
		\label{subsec:qualitative_comparison}
    	
		A quantitative comparison between all \ac{vbl} systems is impossible due to the diversity in both methods and applications. Nevertheless, we refer reader to recent papers that quantitatively compare specific types of state-of-the-art methods. Concerning indirect methods, following recent contributions~\citep{Radenovic2016,Gordo2016} show comprehensive comparisons. Direct F2P methods based on \ac{sfm} are carefully compared on three papers~\citep{Feng2016a,Sattler2016a,Svarm2016} and \citet{Kendall2017} propose a detailed comparison between \ac{sfm}-direct methods (\S\ref{subsec:sfm_methods}) and \ac{cnn}-direct methods (\S\ref{para:cnn_regressor}). In \citep{Brejcha2017}, authors propose an overview of both indirect and direct \ac{vbl} methods by reporting results of various works in a common table. Finally, \citet{Sattler2017} present the first comparison between indirect and direct methods based on images collection for the task of query accurate localization. In the following, we propose our qualitative analysis of \ac{vbl} panorama. 
        
        \paragraph{From indirect to direct methods}
        	As discussed earlier, there is a trade-off between the area covered and the precision reached by the \ac{vbl} system; the survey of \citet{Brejcha2017} provides a complete overview of this problem. Indirect methods prioritize the space coverage, city scale~\citep{Gordo2016} to word-wide~\citep{Weyand2016}, whereas direct methods focus on precision and exact 6 \ac{dof} estimation~\citep{Feng2016a}. This survey describes \ac{vbl} methods in a chronological order, that is why we present indirect methods before direct ones. However, during the last decade, research focus seems to have turned to direct methods. This can be explained by the drastic increase of applications using precise~\ac{vbl} for both professional (\textit{e.g.} robotics~\citep{Majdik2013}) and individual (\textit{e.g.} augmented reality~\citep{Arth2015}) purposes.
        
        \paragraph{The growing importance of geometric data}
        	Limitations of methods using only images have been discussed in Section~\ref{sec:changing_environment}, and the growing accessibility of geometric data promotes the development of systems based on depth information~\citep{Paparoditis2012}. Furthermore, geometric data facilitates the final pose estimation, which also explains the rapid development of direct methods~\citep{Kroeger2014,Pani2015Lmi,Pani2015Robust}. When available, depth information can directly improve the result of \ac{vbl} methods~\citep{Ni2009,Gee2012,Shotton2013,Torii2015,Cavallari}. Point clouds remain the favourite type of geometric data in~\ac{vbl}~\citep{Sattler2016a}, nevertheless less complete but more compact models have shown promising result for some applications~\citep{Ramalingam2010,Bansal2014,Christie2016,Torii2015}.

        \paragraph{Emergence of semantic localization}
        	Less used in \ac{vbl}, semantic data offer promising results~\citep{Ardeshir2014,Castaldo2015,Christie2016}. In addition to being generic regarding the original ``raw'' scene representation, semantic abstraction permits a discriminative and robust description of the scene. Moreover, the use of semantic graph representations can handle huge amount of data. Loss in area coverage granted by the use of direct methods and complex data can be balanced by semantic information. Indeed, in \citep{Ardeshir2014,Lu2015} authors initially narrow the research scope with extracted semantic clues.
        
        \paragraph{Data combination and cascade schemes}
        	Getting both wide area coverage and high precision of the query pose is the current challenge of \ac{vbl}. Cascade scheme, that can be seen as a combination of indirect and direct methods, are certainly a good alternative to achieve this objective~\citep{Sattler2017}. Indeed, firstly reducing the amount of data and in a second step recovering the exact pose of the query is a well studied topic~\citep{Rubio2015,Azzi2016,Song2016,Meng2016,Sattler2017}. This architecture facilitates the use of heterogeneous data~\citep{Lu2015} in a common framework. Combination of various types of data benefits to the task of \ac{vbl} by exploiting all the available sources of interest present at a given location~\citep{Li2016}.
            
	\subsection{Benefit of heterogeneous data}
    	All along this survey we emphasize the growing importance of multiple types of data (optical, geometric and semantic information) for the task of \ac{vbl}. As discussed in section~\ref{sec:application}, using more sophisticate data aims to overcome shortcoming (presented in section~\ref{sec:changing_environment}) of only-optical based systems. Geometric and depth information permit a total abstraction to the pixel intensity, naturally providing to the system a robustness to illumination variability that can occur in the scene. Local changes in scene appearance and geometry can also be handle with the use of a semantic representation. Optical data, though, contain extremely specific information and are much more easier to collect compared to semantic and geometric data. That is why these three aforementioned data should be considered as complementary information. Based on these observations, there is a real benefit of using heterogeneous data to achieve better results in \ac{vbl}.
		
	\subsection{VBL and machine learning} 
    	\ac{vbl} benefits from the recent progress in machine learning. Indirect methods are now dominated by \ac{cnn} approaches~\citep{Radenovic2016,Gordo2016} (see \S\ref{para:global_cnn}). Image description obtained with convolutional networks gathers all the characteristics needed for the task of scene retrieval. New network architecture has been proposed to resolve the direct \ac{vbl} problem (presented in \S\ref{para:cnn_regressor}). Despite the simplicity and the robustness of these methods, state-of-the-art direct localization results are still obtained through point to feature approaches~\citep{Walch2016a}. However, active researches are pursuing in this promising direction~\citep{Liu2016,Jia2016,Kendall2017}. The last \ac{vbl} sub-domain improved by \ac{cnn} is the semantic scene segmentation and categorization used in some localization methods~\citep{Salas-Moreno2013,Ardeshir2014,Arth2015,Christie2016}. Conventional methods, like Deformable Parts Model (DPM)~\citep{Ardeshir2014}, SVM~\citep{Arth2015} or Automatic Labelling Environment (ALE)~\citep{Christie2016}, should be quickly replaced by CNN~\citep{Sunderhauf2015a,Zhao2016}.