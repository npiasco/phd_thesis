\section{Discussion}
\label{sec:comparison}
	As \ac{vbl} panorama is wide and varied, we first propose a review of recent datasets and evaluation metrics used for comparing different approaches. Afterwards, we highlight common usage and promising research avenues in \ac{vbl}.
	
	\subsection{Datasets}
		Commonly used datasets in \ac{vbl} are presented in table~\ref{tab:dataset}. Because of the important difference between 6-\ac{dof} pose estimation and \ac{cbir} for localization, there exists two kinds of datasets used in \ac{vbl}: list of images (with basic position information or landmark/place tags) and strongly structured datasets (that can be composed of point cloud or fine geo-referenced images). Notice the growing number of publicly available datasets starring complete 3D scans of large cities~\citep{Menze2015,Maddern2016,Wang2016}. As mentioned earlier, long-term localization in changing environment is an hot topic in robotic research. We observe therefore appearance of several datasets featuring multiple acquisitions of the same place over long period of time~\citep{Maddern2016,Carlevaris-Bianco2016,Krajnik2010,Krajnik2014}.
		
		For landmarks recognition in city (used method come mainly from \ac{cbir} for localization approaches), the most used dataset is the revisited version of Oxford and Paris landmarks~\citep{Radenovic2018}. Concerning precise 6-\ac{dof} pose estimation under changing condition, researchers prefer the recent benchmark from \citet{Sattler2018} that compiles multiples datasets focused on long-term localization scenario.
		
		\paragraph{Coverage and consistency.}
		\label{para:coverage_consistency}
		All the application relying on \ac{vbl} do not cover the same area. For instance, a system design for car pose estimation should be able to localize a vehicle in a larger area than a pedestrian \ac{vbl} system should do. Thus, there exists dataset with a coverage spreading from small indoor scenes to world-wide area.
	
		Visual content within a dataset can be uniform, reference and queries are from the same sensor and captured at the same time, or inconsistent, queries have been taken under different condition or with different sensor than the references data. In order to reflect real-life conditions, outdoor datasets are often inconsistent, with visual dissimilarity between queries and references induced by acquisition sensors, dynamic changes in the scene (cars \& pedestrians),  weather conditions etc. Indoor datasets use more uniform data~\citep{Shotton2013}, thus targeting application like camera re-localization for robot navigation or augmented reality.

		\paragraph{Evaluation Metrics.}
		\label{subsec:evaluation_metric}
			Authors use various types of performances criteria in order to compare \ac{cbir} for localization methods. The recall @$k$, or recall @$k$\%, is the most used metric. It represents the percentage of queries that present a good match within the $k$ or $k$\% top ranked images. A query is considered correctly localized if it lies inside a tolerance radius from its ground truth position (from 10 to 25m, depending on the dataset).  Usually $k$ is set to 10 or 1\%. If we consider only the top 1 retrieved candidate for evaluation, distance from the ground truth is used as the main precision criteria. For places or landmarks recognition tasks~\citep{Radenovic2018}, \ac{map} evaluate performances of the method.
			
			Concerning 6-\ac{dof} pose estimation methods, authors simply compute the median (rarely the mean) of absolute position and orientation error relative to the ground truth. Another criterion can be extracted from the inlier count obtained against a robust geometric verification (for image based localization). A query is considered as successfully matched if enough inliers are found after \ac{ransac}. However, such a metric does not ensure that the data is well localized according to the model~\citep{Sattler2015}. Percentage of well localized images, \ie under a given error threshold (\eg 5cm \& 5$^{\circ}$ for indoor scene), is also a current evaluation metric.  Recently, \citet{Sattler2018} introduce a more detailed metric by considering multiple level of precision (from fine to coarse localization) with different thresholds.
			
	 \input{2_visual_based_localization/tabs/datasets}
			
	\subsection{Trends in VBL}
		\label{subsec:qualitative_comparison}
    	
		A quantitative comparison between all \ac{vbl} systems is impossible due to the diversity in both methods and applications. Nevertheless, we refer reader to recent papers that quantitatively compare specific types of state-of-the-art methods. Concerning \ac{cbir} methods, following recent contributions~\citep{Radenovic2016,Gordo2016} show comprehensive comparisons. In~\citep{Radenovic2018}, authors benchmark state-of-the-art methods on the Revisited Oxford and Paris dataset. F2P methods based on \ac{sfm} are carefully compared on three papers~\citep{Feng2016a,Sattler2016a,Svarm2016}. A comprehensive comparison between 6-\ac{dof} pose estimation approaches, both learned and structured based, is presented in~\citep{Sattler2019}. We refer readers to the \href{https://www.visuallocalization.net/benchmark/}{online} leader-board of the visual localization benchmark~\citep{Sattler2018} for up-to-date bests methods for pose estimation under challenging conditions. In the following, we propose our qualitative analysis of \ac{vbl} panorama. 
        

        \paragraph{Method development.}
        	As discussed earlier, there is a trade-off between the area covered and the precision reached by the \ac{vbl} system; the survey of \citet{Brejcha2017} provides a complete overview of this problem. \ac{cbir} for localization methods prioritize the space coverage, city scale~\citep{Gordo2016} to word-wide~\citep{Vo2017}, whereas full pose computation methods focus on precision and exact 6-\ac{dof} estimation~\citep{Feng2016a} on reduced area. 

	        Getting both wide area coverage and high precision of the query pose is the current challenge of \ac{vbl}. As shown in~\citep{Sattler2017}, coarse to find localization systems (see chapter~\ref{chap:4}) are certainly a good alternative to achieve this objective. By firstly reducing the amount of data and in a second step recovering the exact pose of the query is a clever manner to target both pose precision and scalability. Cascade localization is a well studied topic~\citep{Rubio2015,Azzi2016,Song2016,Meng2016,Sattler2017}, and more and more recent works address the location problem in this way~\citep{Sarlin2018a,Sarlin2018,Germain2019}.
     
     	\paragraph{Benefit of heterogeneous data.}
	     	All along this survey we emphasize the growing importance of multiple types of data (optical, geometric and semantic information) for the task of \ac{vbl}. As discussed in section~\ref{sec:application}, using more sophisticate data aims to overcome shortcoming of radiometric based systems.
	     	Geometric data improve the final pose estimation~\citep{Pani2015Lmi,Pani2015Robust,Taira2018} and are robust to radiometric changes that we encounter in long-term localization~\citep{Uy2018}. Semantic representation also offer promising results. High degree of abstraction data description is generic regarding the raw data~\citep{Salas-Moreno2013} and can handle local changes in scene appearance and geometry~\citep{Weinzaepfel2019}. Images, though, contain extremely explanatory clues~\citep{Arandjelovic2017} and are much more easier to collect compared to semantic and geometric data. That is why, when considered as complementary information, these three type of data offer the most effective scene understanding for~\ac{vbl}~\citep{Schonberger2017a}.	     		     	
	     	
     
		\paragraph{The growing importance of machine learning}
			\ac{vbl} benefits from the recent progress in machine learning. Indirect methods are now dominated by \ac{cnn} approaches~\citep{Radenovic2016,Gordo2016} (see \S\ref{para:global_cnn}). Image description obtained with convolutional networks gathers all the characteristics needed for the task of scene retrieval. New network architecture has been proposed to resolve the direct \ac{vbl} problem (presented in \S\ref{para:cnn_regressor}). Despite the simplicity and the robustness of these methods, state-of-the-art direct localization results are still obtained through point to feature approaches~\citep{Walch2016a}. However, active researches are pursuing in this promising direction~\citep{Liu2016,Jia2016,Kendall2017}. The last \ac{vbl} sub-domain improved by \ac{cnn} is the semantic scene segmentation and categorization used in some localization methods~\citep{Salas-Moreno2013,Ardeshir2014,Arth2015,Christie2016}. Conventional methods, like Deformable Parts Model (DPM)~\citep{Ardeshir2014}, SVM~\citep{Arth2015} or Automatic Labelling Environment (ALE)~\citep{Christie2016}, should be quickly replaced by CNN~\citep{Sunderhauf2015a,Zhao2016}.
     
     	\paragraph{Runtime consideration}
	     	\label{para:runtime}
	     	Real-time performances and embedded architectures are constraints mainly present in the robotic community. In \ac{vbl}, such criteria are not always taken into account. This can be explained by the fact that recovering the localization of an input query is a one-shoot action; i.e. it has to be performed only once compared to tracking systems~\citep{Marchand2016} or SLAM algorithms~\citep{Garcia-Fidalgo2015}. Furthermore, more and more embedded systems rely on deported architecture or cloud computer, resolving the problem of low computational power of portable devices~\citep{Middelberg2014}. Yet, some authors manage to reduce the computational cost of their system~\citep{Shotton2013,Glocker2015,Lynen2015}: for instance \citet{Feng2016a} introduce a light version of F2P method and works from~\citep{Weyand2016,Kendall2015,Contreras2017} embed their localization system in a compact CNN architecture loadable on a smart-phone. 
	     	
	     	reduced CNN models trained by distillation 
	        
        
        
            